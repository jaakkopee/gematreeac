
<html>
    <head>
        <title>GemaTreeAC 2=0 Gematria Calculator</title> 

        <!--link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css"-->
        <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
        <meta charset="utf-8">

        <style>
            .opformat{
                font-size: 45px;
                white-space: pre;
                color: red;
                background-color: aquamarine;
            }
            .myBody{
                font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
                font-size: 20px;
                color: red;
                background-color: #0000aa;
                text-align: center;
            }

            .sv_style{
                font-size: 30px;
                color: black;
                background-color: blueviolet;
            }
            .creditStaili{
                position: relative;
                left:40%;
                color:aqua;
                background-color: black;
                width:20%;
            }
            .tutStaili{
                position: relative;
                left:40%;
                color:blueviolet;
                background-color:#3f0e3a;
                width:20%;
            }
            .money{
                position:relative;
                left:40%;
                color:black;
                background-color:white;
                width:20%;
            }
            .contactMe{
                position:relative;
                left:40%;
                color:white;
                background-color:indigo;
                width:20%;
            }
            .moneyLink{
                color:indigo;
            }
            .emailLink{
                color:white;
            }

            /* Dropdown Button */
            .dropbtn {
                background-color: #084800;
                color: rgb(255, 79, 223);
                padding: 16px;
                font-size: 16px;
                border: none;
                transition: background-color 0.5s ease;
            }

            /* The container <div> - needed to position the dropdown content */
            .dropdown {
                position: relative;
                display: inline-block;
            }

            /* Dropdown Content (Hidden by Default) */
            .dropdown-content {
                display: none;
                position: absolute;
                background-color: #012700;
                min-width: 160px;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                z-index: 1;
            }

            /* Links inside the dropdown */
            .dropdown-content a {
                color: #73ff00;
                padding: 12px 16px;
                text-decoration: none;
                display: block;
                transition: color 0.5s ease;
            }

            /* Change color of dropdown links on hover */
            .dropdown-content a:hover {
                background-color: rgb(101, 217, 221);
                transition: background-color 1.2s ease;
                color:#005644
            }

            /* Change the background color of the dropdown button when hovering */
            .dropdown:hover .dropbtn {
                background-color: #21ff03;
                color:#a80146;        
            }

            .credits{
                color:rgb(0, 255, 179);
                background-color: #1b1b3d;
                text-align: center;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .howtoDBButton{
                border-width: 3px;
                border: green;
                background-color: black;
                color: yellowgreen;
            }
            .howToDB_iframe{
                display: none;
                position: absolute;
                left:200px;
            }

        </style>
        
    </head>   

    <body class="myBody">
        <div class="credits">GemaTreeAC 2=0 Gematria Calculator, Numerological Classification Algorithm and Database. Copyleft 2022, Jake Pii Taivossuora, Do What Thou Wilt.</div>
        <img src="./GemaTreeAC_logo02.jpeg" width="1100" height="200"><br />
        <py-env>
            - paths:
                - ./ndigitsets3.py
                - ./gematriac.db
                - ./gemNumFuncs.py
                - ./alphabet.py
                - ./getwordsfromdbs.py   
        </py-env>
        
        <py-script>
        from js import window, document, MouseEvent, localStorage, console
        from pyodide import create_proxy
        import ndigitsets3 as nds
        from alphabet import getCipher
        from alphabet import cipher as allCiphers
        from gemNumFuncs import getGematria, getParentList
        from getwordsfromdbs import searchDeepMemByNumberArray

        
        def changeCipher(mE):
            localStorage.setItem("cipher", mE.currentTarget.cipherID)
            document.getElementById('cipherButton').innerHTML="Cipher In Use: "+localStorage.getItem("cipher")
            console.log(localStorage.getItem("cipher"))
            smviewDOC.getElementById("WizardsComments").innerHTML=""
            clearSentenceFormulaNoMouse()
            smNoAddWordNoMouseNoChange()
            updateGemValMsgNotMouse()     
            return
       
        </py-script>

        <div class="dropdown">
            <button class="dropbtn" id="cipherButton">Cipher in use</button>
            <div class="dropdown-content" id="ddc">
                <a href="#cipherButton" id="ccscaext">English/Scandinavian Extended</a>
                <a href="#cipherButton" id="ccengextrev">English Extended Reverse</a>
                <a href="#cipherButton" id="ccord">Ordinal</a>
                <a href="#cipherButton" id="ccordrev">Reverse Ordinal</a>
                <a href="#cipherButton" id="ccfr">Full Reduction</a>
                <a href="#cipherButton" id="ccfrrev">Reverse Full Reduction</a>
                <a href="#cipherButton" id="ccsr">Single Reduction</a>
                <a href="#cipherButton" id="ccsrrev">Reverse Single Reduction</a>
                <!--a href="#cipherButton" id="ccsat">Satanic 36</a>
                <a href="#cipherButton" id="ccsatrev">Reverse Satanic 36</a>
                <a href="#cipherButton" id="ccinv">Inverse</a>
                <a href="#cipherButton" id="ccinvrev">Reverse Inverse</a>
                <a href="#cipherButton" id="cctri">Tridenary</a>
                <a href="#cipherButton" id="cctrirev">Reverse Tridenary</a>
                <a href="#cipherButton" id="cctriad">Tridenary AscDesc</a>
                <a href="#cipherButton" id="cctriadrev">Reverse Tridenary AscDesc</a>
                <a href="#cipherButton" id="cc6">Six</a>
                <a href="#cipherButton" id="cc6rev">Reverse Six</a>
                <a href="#cipherButton" id="cc11">Eleven</a>
                <a href="#cipherButton" id="cc11rev">Reverse Eleven</a>
                <a href="#cipherButton" id="cc18">Eighteen</a>
                <a href="#cipherButton" id="cc18rev">Reverse Eighteen</a>
                <a href="#cipherButton" id="cc22">Twenty Two</a>
                <a href="#cipherButton" id="cc22rev">Reverse Twenty Two</a>
                <a href="#cipherButton" id="cc26">Twenty Six</a>
                <a href="#cipherButton" id="cc26rev">Reverse Twenty Six</a>
                <a href="#cipherButton" id="cc27">Twenty Seven</a>
                <a href="#cipherButton" id="cc27rev">Reverse Twenty Seven</a>
                <a href="#cipherButton" id="cc28">Twenty Eight</a>
                <a href="#cipherButton" id="cc28rev">Reverse Twenty Eight</a>
                <a href="#cipherButton" id="cc33">Thirty Three</a>
                <a href="#cipherButton" id="cc33rev">Reverse Thirty Three</a>
                <a href="#cipherButton" id="cc37">Thirty Seven</a>
                <a href="#cipherButton" id="cc37rev">Reverse Thirty Seven</a-->
            </div>
          </div><br />
        <py-script>
        menuActive=False
        def toggleMenu(mE):
            global menuActive
            if not menuActive:
                document.getElementById("ddc").style.display="block"
                menuActive=True
            else:
                document.getElementById("ddc").style.display="none"
                menuActive=False
            return

        ddButton=document.getElementById("cipherButton")
        ddButton.addEventListener("click", create_proxy(toggleMenu))
    
        ccButton=document.getElementById("ccscaext")
        ccButton.cipherID="ScaExt"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccengextrev")
        ccButton.cipherID="EngExtRev"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccord")
        ccButton.cipherID="Ord"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccordrev")
        ccButton.cipherID="OrdRev"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccfr")
        ccButton.cipherID="FullR"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccfrrev")
        ccButton.cipherID="FullRRev"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccsr")
        ccButton.cipherID="SingRed"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        ccButton=document.getElementById("ccsrrev")
        ccButton.cipherID="SingRedRev"
        ccButton.addEventListener("click", create_proxy(changeCipher))

        #Implement these too---v

        #ccButton=document.getElementById("ccsat")
        #ccButton.cipherID="Sat36"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("ccsatrev")
        #ccButton.cipherID="Sat36Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("ccinv")
        #ccButton.cipherID="Inv"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("ccinvrev")
        #ccButton.cipherID="InvRev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cctri")
        #ccButton.cipherID="Trid"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cctrirev")
        #ccButton.cipherID="TridRev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cctriad")
        #ccButton.cipherID="TridAD"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cctriadrev")
        #ccButton.cipherID="TridADRev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc6")
        #ccButton.cipherID="6"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc6rev")
        #ccButton.cipherID="6Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc11")
        #ccButton.cipherID="11"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc11rev")
        #ccButton.cipherID="11Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc18")
        #ccButton.cipherID="18"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc18rev")
        #ccButton.cipherID="18Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc22")
        #ccButton.cipherID="22"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc22rev")
        #ccButton.cipherID="22Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc26")
        #ccButton.cipherID="26"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc26rev")
        #ccButton.cipherID="26Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc27")
        #ccButton.cipherID="27"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc27rev")
        #ccButton.cipherID="27Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc28")
        #ccButton.cipherID="28"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc28rev")
        #ccButton.cipherID="28Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc33")
        #ccButton.cipherID="33"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc33rev")
        #ccButton.cipherID="33Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc37")
        #ccButton.cipherID="37"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        #ccButton=document.getElementById("cc37rev")
        #ccButton.cipherID="37Rev"
        #ccButton.addEventListener("click", create_proxy(changeCipher))

        </py-script>
        <input id="wordsHere" value="text here"></input>
        <button type="button" id ="addWordToSM">Add Word(s) To Session Memory</button>
        <button type="button" id="clearSM">Clear SM</button>
        <button type="button" id="clearSF">Clear Sentence Formula</button><br />
        <button type="button" id="uploadDB">Upload Local DB</button>
        <button class="howtoDBButton" id="howtoDB">About DB Format</button>

     <br><iframe class="howToDB_iframe" id="howToLoadLocalDB" src="db_howto.html" width="360" height="240"></iframe>

        <!--py-repl></py-repl-->

        <div id="messageout"></div>

        <py-script> 
        htdbDOC = document.getElementById('howToLoadLocalDB').contentWindow.document
                
        htdb_isOpen=False
        def openHowToDB(evt):
            global htdb_isOpen
            if not htdb_isOpen:
                document.getElementById("howToLoadLocalDB").style.display="block"
                htdb_isOpen=True
            else:
                document.getElementById("howToLoadLocalDB").style.display="none"
                htdb_isOpen=False
            return
    
    
        document.getElementById("howtoDB").addEventListener("click", create_proxy(openHowToDB))
        
        import asyncio
        async def openDBFile(evt):
            file=None
            try:
                fileHandle = await window.showOpenFilePicker()
            except Exception as e:
                console.log(str(e))

            try:
                file = await fileHandle[0].getFile()
            except Exception as e:
                console.log(str(e))
            
            
            data = await file.text()
            localStorage.setItem("wizardsHelper", data)
            htdbDOC.getElementById("dataDiv").innerHTML=localStorage.getItem("wizardsHelper")
            return

        htdbDOC.getElementById("dataDiv").innerHTML=localStorage.getItem("wizardsHelper")
        
        document.getElementById("uploadDB").addEventListener('click', create_proxy(openDBFile), False)

        def delWordsFromInputBox(mE):
            document.getElementById("wordsHere").value=""
            updateGemValMsgNotMouse()
            return

        def addWordsWithEnter(kP):
            if kP.key=="Enter":
                smAddWordWithEnter()
            return

        document.getElementById("wordsHere").addEventListener("click", create_proxy(delWordsFromInputBox))
        document.getElementById("wordsHere").addEventListener("keypress", create_proxy(addWordsWithEnter))

        smviewDOC=document.getElementById('smview').contentWindow.document

        def initFS():
            sentenceFormula=localStorage.getItem("sentenceFormula").split()
            newFsIdxStr=""
            for i in sentenceFormula:
                newFsIdxStr+="0 "

            localStorage.setItem("finalSentenceIdx", newFsIdxStr)
            return

        def getWordValuePairsOuter():
            data=localStorage.getItem("words").split()
            outdata=[]
            for i in data:
                word = i
                number = getGematria(i, localStorage.getItem("cipher")) 
                outdata+= [(word, number)]
            return outdata
        

        def printWizardsComments(mE):
            
            pressedNumber=int(mE.currentTarget.datum)
            pl = getParentList(pressedNumber)
            wvpairsFromDeepMemFormattedPL=""

            for i in pl:
            
                wvpairsFromDeepMem = searchDeepMemByNumberArray(i, localStorage.getItem("cipher"))
                wvpairsFromDeepMemFormatted=""

                for j in wvpairsFromDeepMem:

                    hyperWord = nds.makeWCHyperWord(j[0]) #in an external python function because inline doesn not work
                    console.log(hyperWord)
                    wvpairsFromDeepMemFormatted+=hyperWord+" "+str(j[1])+"\n"

                wvpairsFromDeepMemFormattedPL+=wvpairsFromDeepMemFormatted
            
            wizardsHelperData=localStorage.getItem("wizardsHelper").split()
            ldb_outputStr=""
            ldb_printed=[]
            for i in wizardsHelperData:
                if getGematria(i, localStorage.getItem("cipher"))==pressedNumber:
                    ldb_outputStr+=nds.makeLocDBHyperWord(i)+str(getGematria(i, localStorage.getItem("cipher")))
                    ldb_printed+=[i]

            smviewDOC.getElementById("WizardsComments").innerHTML="Wizard Meditation on Route "+str(pl)+"\n(Wizard\'s DeepMem-database from\nkotus-sanalista_v1,\nWordNet 3.1,\nGothenburg uni. Saldo 2.3\nand Väestötietojärjestelmän Etunimitilasto)\n\n"+wvpairsFromDeepMemFormattedPL+ldb_outputStr
            smviewDOC.location = "./sessionmemory.html#WChdr"

            for i in pl:
            
                wvpairsFromDeepMem = searchDeepMemByNumberArray(i, localStorage.getItem("cipher"))
                for j in wvpairsFromDeepMem:
                    makeWCListener(j[0])

                
            for i in ldb_printed:
                makeLocDBListener(i)

            return

        proxyFunc=create_proxy(printWizardsComments)

        def moveWordFromDMtoSW(mE):
            console.log(mE)
            pressedWord=mE.currentTarget.sana
            console.log("moveWordFromDMtoSW: "+pressedWord)

            nds.clearRAM()
            words = localStorage.getItem("words")
            new_words=words+" "+pressedWord+" "

            oldWordArray=words.split()
            if not pressedWord in oldWordArray:
                localStorage.setItem("words", new_words)  
            
            outputWords()     
            makeSWListeners()
            upDateSentenceFormulaNoChange()
            console.log("updated udsfnc in mwfdw2sw")
            smviewDOC.location = "./sessionmemory.html#number"+str(getGematria(pressedWord, localStorage.getItem("cipher")))
            return

        wcProxyFunc=create_proxy(moveWordFromDMtoSW)

        hwMenuControl={}
        def hwMenuReveal(mE):
            global hwMenuControl
            console.log(str(hwMenuControl))            
            datum=mE.currentTarget.datum
            console.log("hwMenuReveal:"+str(datum))
            element=smviewDOC.getElementById("hwmc_"+datum)
            
            if not hwMenuControl["hwmenu_"+datum]:
                element.style.display="block"
                hwMenuControl["hwmenu_"+datum]=True
            else:
                element.style.display="none"
                hwMenuControl["hwmenu_"+datum]=False
            return

        def hwNumberMenuReveal(mE):
            global hwMenuControl 
            console.log(str(hwMenuControl))           
            datum=mE.currentTarget.datum
            console.log("hwNumberMenuReveal:"+str(datum))
            element=smviewDOC.getElementById("hwmc_"+datum)
            
            if not hwMenuControl["hwmenu_"+datum]:
                element.style.display="block"
                hwMenuControl["hwmenu_"+datum]=True
            else:
                element.style.display="none"
                hwMenuControl["hwmenu_"+datum]=False
            return

    
        def hwSearchWM(mE):
            console.log("hwSearchWM:"+str(mE.currentTarget.datum))
            printWizardsComments(mE)
            return

        def hwAddToSF(mE):            
            console.log("hwAddToSF:"+str(mE.currentTarget.datum))
            upDateSentenceFormula(mE)
            return

        def deleteFromSM(mE):
            console.log("deleteFromSM:"+str(mE.currentTarget.datum))
            return

        hwMenuProxy=create_proxy(hwMenuReveal)
        hwNumberMenuProxy=create_proxy(hwNumberMenuReveal)

        def makeSWListeners():
            console.log("makeSWListeners()")
            wvpairs=getWordValuePairsOuter()
            global hwMenuControl, hwMenuProxy, hwNumberMenuProxy
            hwMenuControl={}


            for i in wvpairs:
                currentNumber=i[1]
                if currentNumber!=0:

                    hwNumberButton = smviewDOC.getElementById("hwb_"+str(currentNumber))
                    hwMenuControl["hwmenu_"+str(currentNumber)]=False
                    if hwNumberButton != None:
                        console.log("creating eL at numberButtonMenuReveal hwb_"+str(currentNumber))
                    else:
                        console.log("FAIL: hwb_"+str(currentNumber))
                    hwNumberButton.datum=str(currentNumber)
                    hwNumberButton.addEventListener("click", hwNumberMenuProxy)

                    hwnbMenuElement1 = smviewDOC.getElementById("hwWCSearch_"+str(currentNumber))
                    if hwnbMenuElement1 != None:
                        console.log("creating eL at numberButtonMenu1 hwWCSearch_"+str(currentNumber))
                    else:
                        console.log("FAIL: hwWCSearch_"+str(currentNumber))    
                    hwnbMenuElement1.datum=str(currentNumber)
                    hwnbMenuElement1.addEventListener("click", create_proxy(hwSearchWM))
                    
                    hwnbMenuElement2 = smviewDOC.getElementById("hwSF_"+str(currentNumber))
                    if hwnbMenuElement2 != None:
                        console.log("creating eL at numberButtonMenu2 hwSF_"+str(currentNumber))
                    else:
                        console.log("FAIL: hwSF_"+str(currentNumber))
                    hwnbMenuElement2.datum=currentNumber
                    hwnbMenuElement2.addEventListener("click", create_proxy(hwAddToSF))
                    
        
                    #word buttons
                    for word in localStorage.getItem("words").split():
                        # check if words are on the same route to root
                        if getParentList(getGematria(word, localStorage.getItem("cipher")))[1:]\
                        ==getParentList(int(currentNumber))[1:]:
                            
                            hwWordButton1 = smviewDOC.getElementById("hwb_"+word)
                            hwMenuControl["hwmenu_"+str(word)]=False
                            if hwWordButton1 != None:
                                console.log("creating eL at wordButtonMenuReveal hwb_"+word)
                            else:
                                console.log("FAIL: hwb_"+word)
                            hwWordButton1.addEventListener("click", hwNumberMenuProxy)
                            hwWordButton1.datum=word
                                                    
                            hwwbMenuElement1 = smviewDOC.getElementById("hwDel_"+word)
                            if hwwbMenuElement1 != None:
                                console.log("creating eL at wordButtonDelMenuItem hwDel_"+word)
                            else:
                                console.log("FAIL: hwDel_"+word)
                            hwwbMenuElement1.datum = word
                            hwwbMenuElement1.addEventListener("click", create_proxy(deleteFromSM))
                        
            console.log(str(hwMenuControl))
            return   
        
        """
        def makeWordGrpListeners():
            console.log("makeWordGrpListeners()")
            wordArray = nds.make2DWordArrayFromString(localStorage.getItem("words"), localStorage.getItem("cipher"))
            for i in wordArray:

                gemVal=getGematria(i[0], localStorage.getItem("cipher"))
                wordButtonWG=smviewDOC.getElementById("words"+str(gemVal))
                wordButtonWG.addedFormulaElement=i
                wordButtonWG.addEventListener('click', sentenceFormula_proxy)

            return
        """

        def makeFinalSentenceListeners():
            console.log("makeFinalSentenceListeners()")
            wordArray = nds.make2DWordArrayFromString(localStorage.getItem("words"), localStorage.getItem("cipher"))
            sentenceFormulaArray = localStorage.getItem("sentenceFormula").split()
            for i in sentenceFormulaArray:
                for j in wordArray:
                    if int(i)==getGematria(j[0], localStorage.getItem("cipher")):                       
                        for k in range(len(j)):
                            console.log("word is: "+j[k])
                            sfWordButton=smviewDOC.getElementById("SF"+j[k])
                            sfWordButton.index=k
                            sfWordButton.gemVal=getGematria(j[0], localStorage.getItem("cipher"))
                            sfWordButton.word=j[k]
                            sfWordButton.addEventListener('click', finalSentence_proxy)

            return

        def makeWCListener(word):
            console.log("makeWCListener: "+word)
            wordButton=smviewDOC.getElementById("WC"+word)
            wordButton.sana=word
            wordButton.addEventListener("click", wcProxyFunc)
            return
    
        def makeLocDBListener(word):
            console.log("makeLocDBListener: "+word)
            wordButton=smviewDOC.getElementById("LDB"+word)
            wordButton.sana=word
            wordButton.addEventListener("click", wcProxyFunc)
            return

        def outputWords():
            #wvpairs=getWordValuePairsOuter()

            #for i in wvpairs:
            #    nds.addWord(i[0], localStorage.getItem("cipher"))

            nds.clearRAM()
            nds.addWordArray(localStorage.getItem("words").split(), localStorage.getItem("cipher"))

            gtRepre=nds.printAll(localStorage.getItem("cipher"))
            console.log("From outputWords: gtRepre\n"+gtRepre)
            console.log("nds.roots[n].getWords():")
            
            for root in nds.roots:
                console.log("Root "+str(root.root)+" words:\n"+str(root.getWords()))

            smviewDOC.getElementById("smview_output").innerHTML=gtRepre
            return

        def getInputStringGemValue(inputString):
            inputString=inputString.lower()  
            inputArray=inputString.split()
            outputString=""
            for i in inputArray:
                for j in i:
                    if j.isalpha():
                        outputString+=j
            return getGematria(outputString, localStorage.getItem("cipher"))
        
        def smAddWordWithEnter():
            nds.clearRAM()
            new_words = document.getElementById("wordsHere").value.split()

            for word in new_words:
                oldWordsStr=localStorage.getItem("words")
                word=word.lower()  

                for i in word: 
                    if not i.isalpha():
                        word=word.replace(i,"")

                oldWords=oldWordsStr.split()
                tuplasana=False
                for i in oldWords:
                    if i == word:
                        tuplasana = True
                if not tuplasana:
                    localStorage.setItem("words", oldWordsStr+" "+word+" ")  
            
            
            outputWords()     
            makeSWListeners()
            upDateSentenceFormulaNoChange()
            
            return

        def smAddWord(mE):
            nds.clearRAM()
            new_words = document.getElementById("wordsHere").value.split()

            for word in new_words:
                oldWordsStr=localStorage.getItem("words")
                word=word.lower()  

                for i in word: 
                    if not i.isalpha():
                        word=word.replace(i,"")

                oldWords=oldWordsStr.split()
                tuplasana=False
                for i in oldWords:
                    if i == word:
                        tuplasana = True
                if not tuplasana:
                    localStorage.setItem("words", oldWordsStr+" "+word+" ")  
            
            
            outputWords()     
            makeSWListeners()
            upDateSentenceFormulaNoChange()
            
            return


        def smNoAddWordNoMouseNoChange():
            nds.clearRAM()
            new_words = localStorage.getItem("words").split()
            for word in new_words:
                oldWordsStr=localStorage.getItem("words")
                word=word.lower()  

                for i in word: 
                    if not i.isalpha():
                        word=word.replace(i,"")

                oldWords=oldWordsStr.split()
                tuplasana=False
                for i in oldWords:
                    if i == word:
                        tuplasana = True
                if not tuplasana:
                    localStorage.setItem("words", oldWordsStr+" "+word+" ")  
            
            
            outputWords()     
            makeSWListeners()
            upDateSentenceFormulaNoChange()
            
            return

        def clearSessionMemory(mE):
            localStorage.setItem("words", "0 ")
            localStorage.setItem("sentenceFormula", "0 ")
            initFS()
            nds.clearRAM()
            nds.addWord("0", localStorage.getItem("cipher"))
            smviewDOC.getElementById("WizardsComments").innerHTML=""

            outputWords()
            makeSWListeners()
            upDateSentenceFormulaNoChange()
            
            return

        def clearSessionMemoryNoMouse():
            localStorage.setItem("words", "0 ")
            localStorage.setItem("sentenceFormula", "0 ")
            initFS()
            nds.clearRAM()
            nds.addWord("0", localStorage.getItem("cipher"))
            smviewDOC.getElementById("WizardsComments").innerHTML=""

            outputWords()
            makeSWListeners()
            upDateSentenceFormulaNoChange()
            
            return

        def updateGemValMsg(iE):
            inputString=document.getElementById("wordsHere").value
            output=document.getElementById("messageout")

            output.innerHTML=getInputStringGemValue(inputString)
            
            return

        def updateGemValMsgNotMouse():
            inputString=document.getElementById("wordsHere").value
            output=document.getElementById("messageout")

            output.innerHTML=getInputStringGemValue(inputString)
            
            return
  
        def upDateSentenceFormula(mE):
            output = smviewDOC.getElementById("sentenceFormulaLair")
            fsOutput = smviewDOC.getElementById("finalSentenceLair")

            formula=localStorage.getItem("sentenceFormula")
            newFormula=formula

            afe_gem=mE.currentTarget.datum

            #no duplicates in sf:
            if str(afe_gem) in formula.split():
                return

            if len(formula)>0:
                newFormula+=" "+str(afe_gem)
            else:
                newFormula+=str(afe_gem)

            localStorage.setItem("sentenceFormula", newFormula)
            console.log("IMPORTANT!! udSF/newFormula: '"+str(newFormula)+"'")
            sfOutputStr=nds.makeHyperFormula(newFormula, localStorage.getItem("words"), localStorage.getItem("cipher"))
            
            #initFS()
            updateFsIdx()

            output.innerHTML = sfOutputStr
            makeFinalSentenceListeners()
            printFinalSentence()
            smviewDOC.location = "./sessionmemory.html#sentenceFormulaLair"

            return
     
        def upDateSentenceFormulaNoChange():
            oldWordsStr=localStorage.getItem("words")

            output = smviewDOC.getElementById("sentenceFormulaLair")
            formula=localStorage.getItem("sentenceFormula")
            
            output.innerHTML=nds.makeHyperFormula(formula, oldWordsStr, localStorage.getItem("cipher"))

            #initFS()
            updateFsIdx()

            console.log("upDateSentenceFormulaNoChange: html change in sentenceFormulaLair.")
            makeFinalSentenceListeners()
            printFinalSentence()
            return
 
        def clearSentenceFormula(mE):
            localStorage.setItem("sentenceFormula", "0 ")
            initFS()
            upDateSentenceFormulaNoChange()
            return

        def clearSentenceFormulaNoMouse():
            localStorage.setItem("sentenceFormula", "0 ")
            initFS()
            upDateSentenceFormulaNoChange()
            return

        def updateFsIdx():
            fsIdxStr=localStorage.getItem("finalSentenceIdx")
            fsIdxStr+=" 0 "
            localStorage.setItem("finalSentenceIdx", fsIdxStr)
            return

        def saveNewFinalSentenceIndex(changedWord, gemVal, index):
            fsFormulaArray=localStorage.getItem("sentenceFormula").split()
            fsIdxArray=localStorage.getItem("finalSentenceIdx").split()
            console.log("snfsi/fsI:"+str(fsIdxArray))

            newFsIdxStr=""

            fwc=0
            for i in fsFormulaArray:
                if gemVal == int(i):                    
                    newFsIdxStr+=str(index)+" "
                else:
                    newFsIdxStr+=fsIdxArray[fwc]+" "
                fwc+=1
           
            localStorage.setItem("finalSentenceIdx", newFsIdxStr)
            return
        
        def upDateFinalSentence(mE):
            output=smviewDOC.getElementById("finalSentenceLair")
            saveNewFinalSentenceIndex(mE.currentTarget.word, mE.currentTarget.gemVal, mE.currentTarget.index)
            printFinalSentence()
            return

        def makeFinalSentence():
           
            wordArray=nds.make2DWordArrayFromString(localStorage.getItem("words"), localStorage.getItem("cipher"))
            
            fsFormulaStr=localStorage.getItem("sentenceFormula")
            console.log("fsFormulaStr: '"+fsFormulaStr+"'")
            fsFormulaArray=fsFormulaStr.split()
            
            fsIdxStr=localStorage.getItem("finalSentenceIdx")
            console.log("fsIdx: '"+fsIdxStr+"'")
            fsIdxArray=fsIdxStr.split()

            outputString=""     
            
            fwc=0
            for i in fsFormulaArray:
                for j in wordArray:
                    if getGematria(j[0], localStorage.getItem("cipher"))==int(i):
                        outputString+=j[int(fsIdxArray[fwc])]+" "
                        console.log("mfs: outputString:"+outputString)
                        fwc+=1

            return outputString

        def printFinalSentence():
            output=smviewDOC.getElementById("finalSentenceLair")
            output.innerHTML=makeFinalSentence()
            return

        finalSentence_proxy = create_proxy(upDateFinalSentence)

        #sentenceFormula_proxy = create_proxy(upDateSentenceFormula)

        smaw_proxy = create_proxy(smAddWord)
        document.getElementById("addWordToSM").addEventListener("click", smaw_proxy)
        
        csm_proxy = create_proxy(clearSessionMemory)
        document.getElementById("clearSM").addEventListener("click", csm_proxy)

        gemValMsg_proxy = create_proxy(updateGemValMsg)
        document.getElementById("wordsHere").addEventListener("input", gemValMsg_proxy)

        clearSF_proxy = create_proxy(clearSentenceFormula)
        document.getElementById("clearSF").addEventListener("click", clearSF_proxy)

        #start DBG:
        #localStorage.removeItem("words")
        #localStorage.removeItem("sentenceFormula")
        #localStorage.removeItem("finalSentenceIdx")
        #localStorage.removeItem("cipher")
        #end DBG
        
        if not localStorage.getItem("cipher"):
            localStorage.setItem("cipher", "ScaExt")

        document.getElementById('cipherButton').innerHTML="Cipher In Use: "+localStorage.getItem("cipher")

        if not localStorage.getItem("words"):
            localStorage.setItem("words", "0 ")

        if not localStorage.getItem("sentenceFormula"):
            localStorage.setItem("sentenceFormula", "0 ")

        if not localStorage.getItem("finalSentenceIdx"):
            initFS()

        
        outputWords()
        makeSWListeners()
        upDateSentenceFormulaNoChange()
        updateGemValMsgNotMouse()
        </py-script>

        <!--py-repl></py-repl-->
        <iframe height="600" width="1100" src="sessionmemory.html" id="smview"></iframe>
	    <div id="payPalMe" class="money"><a href="https://paypal.me/taivossuora" target="_blank" class="moneyLink" >Send Money To The Author Via PayPal</a></div>
	    <div id="emailMe" class="contactMe"><a href="mailto:iipekaj@gmail.com" class="emailLink">Contact The Author</a></div>
        <div id="credits" class="creditStaili">GemaTreeAC 2=0 is made with <a href="https://pyscript.net" target="_blank">PyScript</a> and <a href="https://python.org" target="_blank">Python</a></div>
        <div id="tutorialLinkDiv" class="tutStaili"><a href="./GemaTreeAC 2=0 Tutorial.pdf" target="_blank">Tutorial</a></div>
        <div id="gitHubLink" class="creditStaili">The code for GemaTreeAC 2=0 is public and can be found at <a href="https://github.com/jaakkopee/gematreeac" target="_blank">GitHub</a></div>
        <!-- TODO 
            ehkä: paranna tietokantahakua luomalla tietokantayhteys pyscriptissä.
            tee myös hakufunktio tähän tiedostoon.

            implement "Upload local database"
        -->
    </body>
</html>
